{% extends "layout.html" %} 
{% load nix %} 
{% block title %}Checkout - Nixagone{% endblock title %} 

{% block main_content %}
  {% include "partials/heading.html" with title="Checkout" %}

<form action="{% url "checkout" %}" method="post"
      x-data="{
          deliveryCost: 'select a district',
          totalCost: '{{subtotal}}',
          updateDeliveryCost(event) {
              const district = event.target.value;
              if (district === 'Dhaka') {
                  this.deliveryCost = '{% config 'delivery_cost_dhaka' %} ৳';
                  this.totalCost = {{subtotal}} + {% config 'delivery_cost_dhaka' %};
              } else if (district) {
                  this.deliveryCost = '{% config 'delivery_cost' %} ৳';
                  this.totalCost = {{subtotal}} + {% config 'delivery_cost' %};
              } else {
                  this.deliveryCost = 'select a district';
                  this.totalCost = {{subtotal}};
              }
          }
      }"
      class="container flex flex-col md:flex-row gap-6 lg:py-10 max-w-[1200px] mx-auto py-5"
>
{% csrf_token %}

  <!-- CUSTOMER INFO SECTION -->
  <section class="gap-3 grid grid-cols-1 max-w-[1200px] mb-6 w-full">
    <div class="">
      <div class="flex flex-col w-full gap-3">

        <!-- Name & Phone -->
        <div class="flex justify-between w-full gap-2">
          <div class="flex flex-col w-1/2">
            <label class="flex" for="name">
              Full Name<span class="required"></span>
            </label>
            <input
              class="w-full px-4 py-2 border outline-black outline-offset-2 focus:border-transparent"
              type="text"
              name="name"
              id="name"
              placeholder="Name..."
              autocomplete="name"
              value="{{ initial_data.name|default_if_none:'' }}"
              required
            />
          </div>
          <div class="flex flex-col w-1/2">
            <label class="flex" for="phone">
              Phone<span class="required"></span>
            </label>
            <input
              class="w-full px-4 py-2 border outline-black outline-offset-2 focus:border-transparent"
              type="tel"
              name="phone"
              id="phone"
              placeholder="Phone number..."
              required
            />
          </div>
        </div>

        <!-- Email -->
        <div class="flex justify-between w-full gap-2">
          <div class="flex flex-col w-full">
            <label class="flex" for="email">
              E-mail (optional)
            </label>
            <input
              class="w-full px-4 py-2 border outline-black outline-offset-2 focus:border-transparent"
              type="email"
              name="email"
              id="email"
              placeholder="Email address..."
              value="{{ initial_data.email|default_if_none:'' }}"
            />
          </div>
        </div>

        <!-- District -->
        <div class="flex flex-col w-full">
          <label class="flex" for="district">
            District <span class="required"></span>
          </label>
          <select 
            @change="updateDeliveryCost($event)" 
            name="district" 
            id="district" 
            required 
            class="w-full px-4 py-2 bg-white border outline-black outline-offset-2 focus:border-transparent"
          >
            <option value="" selected>--select district--</option>
            {% for district in districts %}
            <option value="{{district}}">{{district}}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Full Address -->
        <div class="flex flex-col">
          <label for="address" class="flex">
            Full address<span class="required"></span>
          </label>
          <textarea
            class="w-full h-24 p-2 border outline-black outline-offset-2 focus:border-transparent"
            name="address"
            id="address"
            placeholder="Enter your full address..."
            required
          ></textarea>
          <small class="text-gray-500">thana/upazila, road/village/area, post office, house/flat no.</small>
        </div>

      </div>
    </div>
  </section>
  
  <!-- ORDER SUMMARY & PAYMENT -->
  <section class="md:max-w-[400px] mx-auto w-full">
    <div>
      <!-- ORDER SUMMARY -->
      <div class="px-4 py-5 mb-6 border shadow-md">
        <p class="font-bold">ORDER SUMMARY</p>
        <div class="flex justify-between py-5 border-b">
          <p>Subtotal</p>
          <p>{{subtotal|taka}}</p>
        </div>
        <div class="flex justify-between py-5 border-b">
          <p>Delivery</p>
          <p x-text="deliveryCost"></p>
        </div>
        <div class="flex justify-between py-5">
          <p>Total</p>
          <div class="text-lg font-semibold">
            <span x-text="totalCost"></span><span> ৳</span>
          </div>
        </div>
      </div>

      <!-- PAYMENT METHOD -->
      <div class="px-4 py-5 mb-6 border shadow-md">
        <p class="font-bold">Payment</p>
        <div class="flex justify-between py-2">
          <p class="text-gray-700">Cash on Delivery</p>
        </div>
      </div>
    </div>

    <!-- BUTTONS -->
    <div class="flex items-center justify-between w-full">
        <a href="{% url "products" %}" class="text-sm text-gray-700 hover:text-black">
        ← Back to the shop
        </a>
        <button type="submit" class="px-4 py-2 text-white bg-black">
        Place an order
        </button>
    </div>
  </section>
  
</form>

{% endblock main_content %}
