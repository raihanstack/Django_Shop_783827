{% extends "layout.html" %}
{% load nix %}

{% block title %}Baby & Fashion - Products{% endblock title %}

{% block main_content %}
<div class="mx-auto">
    <!-- Heading Section -->
    {% if search_query %}
        {% include "partials/heading.html" with title="Search" %}
        <p class="container mx-auto mb-6 text-gray-600">Product matching "{{ search_query|escapejs }}"</p>
    {% else %}
        {% include "partials/heading.html" with title="Products" %}
    {% endif %}

    <!-- Search & Filter Form -->
    <form action="{% url 'products' %}" method="get" class="container flex flex-col items-center gap-4 mx-auto mb-6 md:mb-12 md:flex-row">
        <div class="flex items-center w-full gap-4 md:w-auto">
            <label for="select-category" class="font-medium text-gray-700">Category:</label>
            <select name="category" id="select-category" class="w-full px-3 py-2 bg-white border md:w-auto" onchange="this.form.submit()" aria-label="Select a category">
                <option value="">Select a Category</option>
                {% for category in categories %}
                    <option value="{{ category.slug }}" {% if category.slug == current_category %}selected{% endif %}>{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="flex items-center w-full gap-4 mt-4 md:w-auto md:mt-0">
            <label for="search" class="font-medium text-gray-700">Search:</label>
            <input type="text" id="search" name="q" value="{{ search_query }}" class="w-full px-3 py-2 bg-white border md:w-72" placeholder="Search for products" />
            <button type="submit" class="px-4 py-2 mt-4 text-white bg-black md:mt-0">Search</button>
        </div>

        {% if search_query %}
            <input type="hidden" name="q" value="{{ search_query }}">
        {% endif %}
    </form>

    <!-- Product Listing -->
    {% if products %}
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
            {% for product in products %}
                {% product_card product %}
            {% endfor %}
        </div>
    {% else %}
        <div class="flex items-center justify-center py-12 text-xl text-gray-800">
            <p>No products found. Try searching with a different keyword or browse through other categories.</p>
        </div>
    {% endif %}

    <!-- Pagination -->
    <div class="mt-8">
        {% include "partials/pagination.html" %}
    </div>
</div>
{% endblock main_content %}
